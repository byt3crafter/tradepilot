<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
    content="frame-ancestors 'self' https://sandbox-buy.paddle.com https://buy.paddle.com https://*.paddle.com;">
  <title>JTradePilot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Favicon Configuration -->
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">

  <!-- UnicornStudio Animated Background - Landing Page Only (Loaded by React) -->
  <script type="text/javascript">
    // Performance detection and adaptive loading
    window.isHighPerformanceDevice = function () {
      // Check hardware concurrency (CPU cores)
      const cores = navigator.hardwareConcurrency || 2;

      // Check device memory if available (in GB)
      const memory = navigator.deviceMemory || 4;

      // High performance: 4+ cores and 4GB+ RAM
      return cores >= 4 && memory >= 4;
    };

    // Global function for React to load UnicornStudio when on landing page
    window.loadUnicornStudio = function () {
      // Check for reduced motion preference or low power mode
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isLowPerformance = localStorage.getItem('lowPerformanceMode') === 'true';

      if (prefersReducedMotion || isLowPerformance) {
        console.log('[JTradePilot] Animations disabled due to performance/accessibility settings.');
        return;
      }

      // Performance check - only load heavy animation on capable devices
      if (!window.isHighPerformanceDevice()) {
        console.log('[JTradePilot] Using lightweight animation for better performance on this device.');
        return;
      }

      if (window.UnicornStudio && window.UnicornStudio.isInitialized) {
        return; // Already loaded
      }

      if (!window.UnicornStudio) {
        window.UnicornStudio = { isInitialized: false };
      }

      var i = document.createElement("script");
      i.src = "https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.29/dist/unicornStudio.umd.js";
      i.onload = function () {
        if (window.UnicornStudio && !window.UnicornStudio.isInitialized) {
          if (window.UnicornStudio.init) window.UnicornStudio.init();
          window.UnicornStudio.isInitialized = true;
        }
      };
      (document.head || document.body).appendChild(i);
    };

    // Create or remove animated background
    window.showAnimatedBackground = function (show) {
      const bgContainer = document.getElementById('animated-background-container');
      if (!bgContainer) return;

      // Check preferences again
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isLowPerformance = localStorage.getItem('lowPerformanceMode') === 'true';

      if (show && !prefersReducedMotion && !isLowPerformance) {
        // Check if device can handle full animation
        const useFullAnimation = window.isHighPerformanceDevice();

        // Only create background if it doesn't exist
        if (bgContainer.children.length === 0) {
          if (useFullAnimation) {
            // Full UnicornStudio animation for high-performance devices
            bgContainer.innerHTML = `
              <div class="aura-background-component fixed top-0 w-full h-screen z-0 pointer-events-none" data-alpha-mask="80"
                style="mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 70%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 70%, transparent 100%); will-change: transform;">
                <div data-us-project="0WrRbFIPaKoWVkiQWBG0" class="absolute w-full h-full left-0 top-0"></div>
              </div>

              <div class="fixed inset-0 z-0 pointer-events-none" style="
                background-image:
                  linear-gradient(to right, rgba(255,255,255,0.03) 1px, transparent 1px),
                  linear-gradient(to bottom, rgba(255,255,255,0.03) 1px, transparent 1px);
                background-size: 60px 60px;
                background-attachment: fixed;
                mask-image: radial-gradient(ellipse 100% 50% at 50% 50%, black 30%, transparent 100%);
                -webkit-mask-image: radial-gradient(ellipse 100% 50% at 50% 50%, black 30%, transparent 100%);
              "></div>

              <div class="fixed inset-0 z-10 pointer-events-none" style="
                background: radial-gradient(circle at center, transparent 0%, #08090A 100%);
                opacity: 0.8;
              "></div>
            `;

            // Re-init if script is already loaded but content was removed
            if (window.UnicornStudio && window.UnicornStudio.isInitialized && window.UnicornStudio.init) {
              // Small timeout to ensure DOM is ready
              setTimeout(() => window.UnicornStudio.init(), 100);
            }
          } else {
            // Lightweight CSS-only animation for lower-end devices
            bgContainer.innerHTML = `
              <div class="fixed inset-0 z-0 pointer-events-none" style="
                background: radial-gradient(ellipse 80% 50% at 50% 20%, rgba(37, 99, 235, 0.15), transparent 50%),
                            radial-gradient(ellipse 60% 50% at 80% 60%, rgba(139, 92, 246, 0.1), transparent 50%),
                            radial-gradient(ellipse 60% 50% at 20% 80%, rgba(6, 182, 212, 0.1), transparent 50%);
                animation: gradient-shift 15s ease infinite;
                will-change: transform;
              "></div>

              <div class="fixed inset-0 z-0 pointer-events-none" style="
                background-image:
                  linear-gradient(to right, rgba(255,255,255,0.03) 1px, transparent 1px),
                  linear-gradient(to bottom, rgba(255,255,255,0.03) 1px, transparent 1px);
                background-size: 60px 60px;
                background-attachment: fixed;
                opacity: 0.5;
              "></div>

              <style>
                @keyframes gradient-shift {
                  0%, 100% { transform: translateY(0) scale(1); }
                  50% { transform: translateY(-20px) scale(1.05); }
                }
              </style>
            `;
          }
        }
      } else {
        // Remove background content
        if (bgContainer.children.length > 0) {
          bgContainer.innerHTML = '';

          // Attempt to cleanup UnicornStudio if it has a destroy method
          if (window.UnicornStudio && window.UnicornStudio.destroy) {
            try {
              window.UnicornStudio.destroy();
            } catch (e) { console.warn('Failed to destroy UnicornStudio', e); }
          }
        }
      }
    };
  </script>

  <!-- Add Charting Libraries -->
  <script src="https://unpkg.com/d3@7.8.5/dist/d3.min.js"></script>
</head>

<body class="font-sans text-primary antialiased selection:bg-zinc-800 selection:text-white bg-[#08090A]">

  <!-- Animated Background Container - Created dynamically by React on landing page -->
  <div id="animated-background-container"></div>

  <div id="root"></div>

  <script>
    window.APP_CONFIG = (function () {
      const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

      let apiUrl;

      if (isLocal) {
        // In development (localhost), API is on the same machine but different port
        apiUrl = 'http://localhost:8080';
      } else {
        // In production, API is on the same domain
        apiUrl = window.location.origin;
      }

      console.log('[JTradePilot] API URL configured for:', apiUrl);
      console.log('[JTradePilot] Frontend running on:', window.location.origin);

      return {
        API_URL: apiUrl
      };
    })();



    // Check current route immediately (before React loads)
    function initializeBackgroundForCurrentRoute() {
      const path = window.location.pathname;
      const isLandingPage = path === '/';
      window.showAnimatedBackground(isLandingPage);
    }

    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeBackgroundForCurrentRoute);
    } else {
      initializeBackgroundForCurrentRoute();
    }
  </script>

  <script type="module" src="/index.tsx"></script>
</body>

</html>